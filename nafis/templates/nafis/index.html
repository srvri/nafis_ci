<!-- nafis/templates/nafis/index.html -->

{% extends "base.html" %}
{% load static %}

{% block content %}
    <!-- 1. بخش اسلایدشو هدر -->
    <section class="nafis-slideshow">
        {% for slideshow in slideshows %}
            <div class="nafis-slide-item">
                <a href="{% url 'nafis:index' %}">
                    <img src="{{ slideshow.image.url }}" class="img-fluid w-100" alt="{{ slideshow.title|default:'اسلاید' }}">
                </a>
                <div class="nafis-slide-overlay">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-6 col-10">
                                <!-- محتوای روی اسلاید در صورت نیاز -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% empty %}
            <p class="text-center p-5">اسلایدی برای نمایش وجود ندارد.</p>
        {% endfor %}
    </section>

    <!-- 2. بخش جدیدترین محصولات نفیس -->
    <section class="newest-products section-padding">
        <div class="container-fluid">
            <h2 class="text-center mb-5">جدیدترین محصولات نفیس</h2>
            
            <!-- اسلایدر نقطه‌ای محصولات -->
            <div class="dot-slider-wrapper">
                <div class="dot-slider" id="newestSlider" data-items-per-slide="6">
                    <div class="slider-container">
                        {% for apparel in newest_apparels %}
                        <div class="product-card-glass">
                            <a href="{% url 'nafis:apparel_detail' apparel.slug %}" class="product-link">
                                {% if apparel.main_image %}
                                    <img src="{{ apparel.main_image.url }}" class="product-image" alt="{{ apparel.name }}">
                                {% else %}
                                    <img src="{% static 'images/placeholder.png' %}" class="product-image" alt="تصویر موجود نیست">
                                {% endif %}
                            </a>
                            <div class="product-info">
                                <h3 class="product-title">
                                    <a href="{% url 'nafis:apparel_detail' apparel.slug %}" class="product-title-link">{{ apparel.name }}</a>
                                </h3>
                                <p class="product-price">{{ apparel.price|floatformat:0 }} تومان</p>
                            </div>
                        </div>
                        {% empty %}
                        <p class="text-center w-100">محصول جدیدی یافت نشد.</p>
                        {% endfor %}
                    </div>
                </div>
                <div class="slider-dots" id="newestDots"></div>
            </div>
        </div>
    </section>

    <!-- 3. بخش محصولات تخفیف‌دار -->
    <section class="discounted-products section-padding bg-light">
        <div class="container-fluid">
            <h2 class="text-center mb-5">تخفیف شگفت انگیز نفیس</h2>
            
            <!-- اسلایدر نقطه‌ای محصولات -->
            <div class="dot-slider-wrapper">
                <div class="dot-slider" id="discountedSlider" data-items-per-slide="6">
                    <div class="slider-container">
                        {% for apparel in discounted_apparels %}
                        <div class="product-card-glass">
                            <a href="{% url 'nafis:apparel_detail' apparel.slug %}" class="product-link">
                                {% if apparel.main_image %}
                                    <img src="{{ apparel.main_image.url }}" class="product-image" alt="{{ apparel.name }}">
                                {% else %}
                                    <img src="{% static 'images/placeholder.png' %}" class="product-image" alt="تصویر موجود نیست">
                                {% endif %}
                            </a>
                            {% if apparel.has_discount %}
                            <span class="discount-badge">
                                {{ apparel.discounts.first.discount_percentage }}%
                            </span>
                            {% endif %}
                            <div class="product-info">
                                <h3 class="product-title">
                                    <a href="{% url 'nafis:apparel_detail' apparel.slug %}" class="product-title-link">{{ apparel.name }}</a>
                                </h3>
                                <div class="product-price">
                                    {% if apparel.has_discount %}
                                    <span class="original-price">{{ apparel.price|floatformat:0 }} تومان</span>
                                    <span class="discounted-price">{{ apparel.get_discounted_price|floatformat:0 }} تومان</span>
                                    {% else %}
                                    <span>{{ apparel.price|floatformat:0 }} تومان</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <p class="text-center w-100">در حال حاضر محصولی با تخفیف وجود ندارد.</p>
                        {% endfor %}
                    </div>
                </div>
                <div class="slider-dots" id="discountedDots"></div>
            </div>
        </div>
    </section>

    <!-- 4. بخش اطلاعیه‌ها و اخبار -->
    <section class="announcement-section section-padding">
        <div class="container">
            <div class="nafis-slideshow">
                {% for announcement in announcements %}
                    <div class="nafis-slide-item">
                        <a href="{{ announcement.link|default:'#' }}">
                            <img src="{{ announcement.image.url }}" class="img-fluid w-100" alt="{{ announcement.title }}">
                        </a>
                        <div class="nafis-slide-overlay">
                            <div class="container">
                                <div class="row">
                                    <div class="col-lg-8 col-10">
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% empty %}
                <p class="text-center">اطلاعیه جدیدی وجود ندارد.</p>
                {% endfor %}
            </div>
        </div>
    </section>
    
    <!-- 5. بخش محصولات آقایان -->
    <section class="featured-product section-padding">
        <div class="container-fluid">
            <h2 class="text-center mb-5">محصولات آقایان</h2>
            
            <!-- اسلایدر نقطه‌ای محصولات -->
            <div class="dot-slider-wrapper">
                <div class="dot-slider" id="menSlider" data-items-per-slide="6">
                    <div class="slider-container">
                        {% for apparel in men_apparels %}
                        <div class="product-card-glass">
                            <a href="{% url 'nafis:apparel_detail' apparel.slug %}" class="product-link">
                                <img src="{{ apparel.main_image.url }}" class="product-image" alt="{{ apparel.name }}">
                            </a>
                            <div class="product-info">
                                <h5 class="product-title">
                                    <a href="{% url 'nafis:apparel_detail' apparel.slug %}" class="product-title-link">{{ apparel.name }}</a>
                                </h5>
                                <p class="product-price">{{ apparel.price|floatformat:0 }} تومان</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="slider-dots" id="menDots"></div>
            </div>
        </div>
    </section>

    <!-- 6. بخش محصولات بانوان -->
    <section class="featured-product section-padding">
        <div class="container-fluid">
            <h2 class="text-center mb-5">محصولات بانوان</h2>
            
            <!-- اسلایدر نقطه‌ای محصولات -->
            <div class="dot-slider-wrapper">
                <div class="dot-slider" id="womenSlider" data-items-per-slide="6">
                    <div class="slider-container">
                        {% for apparel in women_apparels %}
                        <div class="product-card-glass">
                            <a href="{% url 'nafis:apparel_detail' apparel.slug %}" class="product-link">
                                <img src="{{ apparel.main_image.url }}" class="product-image" alt="{{ apparel.name }}">
                            </a>
                            <div class="product-info">
                                <h5 class="product-title">
                                    <a href="{% url 'nafis:apparel_detail' apparel.slug %}" class="product-title-link">{{ apparel.name }}</a>
                                </h5>
                                <p class="product-price">{{ apparel.price|floatformat:0 }} تومان</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="slider-dots" id="womenDots"></div>
            </div>
        </div>
    </section>

    <!-- 7. بخش محصولات کودکان -->
    <section class="featured-product section-padding">
        <div class="container-fluid">
            <h2 class="text-center mb-5">محصولات کودکان</h2>
            
            <!-- اسلایدر نقطه‌ای محصولات -->
            <div class="dot-slider-wrapper">
                <div class="dot-slider" id="kidsSlider" data-items-per-slide="6">
                    <div class="slider-container">
                        {% for apparel in kids_apparels %}
                        <div class="product-card-glass">
                            <a href="{% url 'nafis:apparel_detail' apparel.slug %}" class="product-link">
                                <img src="{{ apparel.main_image.url }}" class="product-image" alt="{{ apparel.name }}">
                            </a>
                            <div class="product-info">
                                <h5 class="product-title">
                                    <a href="{% url 'nafis:apparel_detail' apparel.slug %}" class="product-title-link">{{ apparel.name }}</a>
                                </h5>
                                <p class="product-price">{{ apparel.price|floatformat:0 }} تومان</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="slider-dots" id="kidsDots"></div>
            </div>
        </div>
    </section>

    <!-- 8. بخش مزایا -->
    <section class="benefits-section section-padding">
        <div class="container">
            <!-- محتوای بخش مزایا -->
        </div>
    </section>
    <style>
        /* ============================================= */
/*           Glassmorphism Product Card (برای گرید) */
/* ============================================= */
.product-card-glass {
  box-sizing: border-box;
  width: 100%;
  height: 100%;
  background: rgba(217, 217, 217, 0.4);
  border: 1px solid rgba(255, 255, 255, 0.5);
  backdrop-filter: blur(6px);
  border-radius: 17px;
  text-align: center;
  cursor: pointer;
  transition: all 0.5s;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  padding: 1rem;
}

.product-card-glass:hover {
  border: 1px solid rgba(0, 0, 0, 0.2);
  transform: scale(1.05);
}

.product-card-glass:active {
  transform: scale(0.95) rotateZ(1.7deg);
}

/* ============================================= */
/*           اسلایدر نقطه‌ای (Dot Slider)         */
/* ============================================= */

.dot-slider-wrapper {
    width: 100%;
    position: relative;
    padding: 2.5rem 0;
    overflow: visible;
}

.dot-slider {
    width: 100%;
    overflow: visible;
    cursor: grab;
    user-select: none;
}

.dot-slider:active {
    cursor: grabbing;
}

.slider-container {
    display: block;
    position: relative;
    width: 100%;
    height: 500px;
    transition: transform 0.6s ease-in-out;
    overflow: visible;
}

.dot-slider .product-card-glass {
    width: calc(100% / 6 - 20px);
    height: 480px;
    margin: 0 10px;
    transition: all 0.3s ease;
}

.dot-slider .product-link {
    display: block;
    overflow: hidden;
    border-radius: 12px;
    margin-bottom: 1rem;
    pointer-events: auto;
}

.dot-slider .product-image {
    width: 100%;
    height: 350px;
    object-fit: cover;
    transition: transform 0.4s ease;
}

.dot-slider .product-card-glass:hover .product-image {
    transform: scale(1.08);
}

.dot-slider .product-info {
    text-align: right;
    padding: 0 0.5rem;
}

.dot-slider .product-title {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 10px;
    line-height: 1.4;
}

.dot-slider .product-title-link {
    color: #2c3e50;
    text-decoration: none;
    transition: color 0.3s;
}

.dot-slider .product-title-link:hover {
    color: #3498db;
}

.dot-slider .product-price {
    font-size: 15px;
    font-weight: 700;
    color: #2c3e50;
    margin: 0;
}

/* بج تخفیف */
.dot-slider .discount-badge {
    position: absolute;
    top: 20px;
    right: 20px;
    background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
    color: white;
    padding: 10px 15px;
    border-radius: 12px;
    font-size: 15px;
    font-weight: bold;
    z-index: 10;
}

/* استایل قیمت تخفیف‌دار */
.dot-slider .original-price {
    color: #95a5a6;
    text-decoration: line-through;
    font-size: 13px;
    display: block;
    margin-bottom: 5px;
}

.dot-slider .discounted-price {
    color: #27ae60;
    font-weight: 700;
    font-size: 16px;
}

/* ============================================= */
/*              نقطه‌های اسلایدر (Dots)           */
/* ============================================= */

.slider-dots {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 12px;
    margin-top: 30px;
    padding: 10px;
}

.slider-dots .dot {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background-color: #bdc3c7;
    cursor: pointer;
    transition: all 0.3s ease;
}

.slider-dots .dot:hover {
    background-color: #95a5a6;
    transform: scale(1.2);
}

.slider-dots .dot.active {
    background-color: #34495e;
    transform: scale(1.3);
}

/* ============================================= */
/*       نوار محصولات متحرک و بی‌نهایت           */
/* ============================================= */

.scrolling-wrapper {
    width: 100%;
    overflow: hidden;
    padding: 2rem 0;
    position: relative;
    -webkit-mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
    mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
}

.card-track {
    display: flex;
    animation: scrollAnimation 60s linear infinite;
}

.card-track:hover {
    animation-play-state: paused;
}

@keyframes scrollAnimation {
    from {
        transform: translateX(0);
    }
    to {
        transform: translateX(-50%);
    }
}

/* استایل پایه برای کارت های متحرک */
.product-card-glass-scroll {
    flex-shrink: 0;
    width: 280px;
    margin: 0 15px;
    
    /* کپی کردن استایل های اصلی از .product-card-glass */
    box-sizing: border-box;
    height: 100%;
    background: rgba(217, 217, 217, 0.4);
    border: 1px solid rgba(255, 255, 255, 0.5);
    backdrop-filter: blur(6px);
    border-radius: 17px;
    text-align: center;
    cursor: pointer;
    transition: all 0.5s;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    padding: 1rem;
}

.product-card-glass-scroll:hover {
  border: 1px solid rgba(0, 0, 0, 0.2);
  transform: scale(1.05);
}

/* ============================================= */
/*       اسلایدر قابل کشیدن با موس              */
/* ============================================= */

.draggable-slider-wrapper {
    width: 100%;
    overflow: hidden;
    padding: 2rem 0;
    position: relative;
}

.draggable-slider {
    display: flex;
    overflow-x: auto;
    overflow-y: hidden;
    scroll-behavior: smooth;
    cursor: grab;
    user-select: none;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
    gap: 20px;
    padding: 10px 20px;
}

.draggable-slider::-webkit-scrollbar {
    display: none;
}

.draggable-slider.grabbing {
    cursor: grabbing;
    scroll-behavior: auto;
}

.draggable-slider .product-card-glass {
    flex: 0 0 280px;
    min-width: 280px;
    height: 380px;
}

/* دکمه های ناوبری */
.slider-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255, 255, 255, 0.9);
    border: none;
    border-radius: 50%;
    width: 45px;
    height: 45px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 10;
    transition: all 0.3s;
}

.slider-nav:hover {
    background: rgba(255, 255, 255, 1);
    transform: translateY(-50%) scale(1.1);
}

.slider-nav.prev {
    left: 10px;
}

.slider-nav.next {
    right: 10px;
}

.slider-nav svg {
    width: 24px;
    height: 24px;
    fill: #333;
}

/* ============================================= */
/*     استایل های داخلی یکپارچه برای کارت ها     */
/* ============================================= */

/* استایل عکس برای همه انواع کارت ها */
.product-card-glass .product-image,
.product-card-glass-scroll .product-image {
    width: 100%;
    height: auto;
    aspect-ratio: 1 / 1;
    object-fit: cover;
    border-radius: 10px;
    margin-bottom: 0.75rem;
}

/* استایل بخش اطلاعات برای همه انواع کارت ها */
.product-card-glass .product-info,
.product-card-glass-scroll .product-info {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    text-align: right;
}

/* استایل لینک عنوان برای همه انواع کارت ها */
.product-card-glass .product-title-link,
.product-card-glass-scroll .product-title-link {
    font-size: 0.9rem;
    font-weight: bold;
    color: #333;
    text-decoration: none;
}

/* استایل قیمت برای همه انواع کارت ها */
.product-card-glass .product-price,
.product-card-glass-scroll .product-price {
    font-size: 0.85rem;
    margin-top: 0.5rem;
}

/* ============================================= */
/*              ریسپانسیو دیزاین                */
/* ============================================= */

/* لپ‌تاپ بزرگ - 6 محصول */
@media (max-width: 1400px) {
    .dot-slider .product-card-glass {
        width: calc(100% / 6 - 20px);
    }
}

/* لپ‌تاپ - 5 محصول */
@media (max-width: 1200px) {
    .slider-container {
        height: 450px;
    }
    
    .dot-slider .product-card-glass {
        width: calc(100% / 5 - 20px);
        height: 450px;
    }
    
    .dot-slider .product-image {
        height: 320px;
    }
}

/* تبلت - 4 محصول */
@media (max-width: 992px) {
    .slider-container {
        height: 430px;
    }
    
    .dot-slider .product-card-glass {
        width: calc(100% / 4 - 20px);
        height: 430px;
    }
    
    .dot-slider .product-image {
        height: 300px;
    }
    
    .dot-slider .product-title {
        font-size: 15px;
    }
}

/* تبلت کوچک - 3 محصول */
@media (max-width: 768px) {
    .dot-slider-wrapper {
        padding: 2rem 0.5rem;
    }
    
    .slider-container {
        height: 390px;
    }
    
    .dot-slider .product-card-glass {
        width: calc(100% / 3 - 20px);
        height: 390px;
        margin: 0 10px;
    }
    
    .dot-slider .product-image {
        height: 260px;
    }
    
    .dot-slider .product-title {
        font-size: 14px;
    }
    
    .dot-slider .product-price {
        font-size: 13px;
    }
    
    .slider-dots .dot {
        width: 12px;
        height: 12px;
    }
    
    .slider-dots .dot.active {
        width: 12px;
        height: 12px;
    }
}

/* موبایل - 2 محصول */
@media (max-width: 576px) {
    .dot-slider-wrapper {
        padding: 1.5rem 0.25rem;
    }
    
    .slider-container {
        height: 350px;
    }
    
    .dot-slider .product-card-glass {
        width: calc(100% / 2 - 16px);
        height: 350px;
        margin: 0 8px;
    }
    
    .dot-slider .product-image {
        height: 230px;
    }
    
    .dot-slider .product-title {
        font-size: 13px;
    }
    
    .dot-slider .product-price {
        font-size: 12px;
    }
    
    .dot-slider .discount-badge {
        padding: 6px 10px;
        font-size: 12px;
        top: 15px;
        right: 15px;
    }
    
    .slider-dots {
        gap: 8px;
        margin-top: 20px;
    }
    
    .slider-dots .dot {
        width: 10px;
        height: 10px;
    }
    
    .slider-dots .dot.active {
        width: 10px;
        height: 10px;
    }
}

/* موبایل کوچک - 1 محصول */
@media (max-width: 480px) {
    .slider-container {
        height: 410px;
    }
    
    .dot-slider .product-card-glass {
        width: calc(100% - 20px);
        height: 410px;
        margin: 0 10px;
    }
    
    .dot-slider .product-image {
        height: 280px;
    }
}

/* ============================================= */
/*           فضای بیشتر برای بخش ها             */
/* ============================================= */

.section-padding {
    padding: 40px 0 30px 0;
}

/* استایل عنوان بخش‌ها */
.section-padding h2 {
    font-size: 1.5rem;
    font-weight: 600;
    position: relative;
    padding-top: 20px;
    padding-bottom: 15px;
    margin-top: 0 !important;
    margin-bottom: 25px !important;
}

/* خط بالای عنوان */
.section-padding h2::before {
    content: '';
    position: absolute;
    top: 0;
    right: 50%;
    transform: translateX(50%);
    width: 80px;
    height: 1px;
    background: linear-gradient(to right, transparent, #34495e, transparent);
}

/* خط پایین عنوان */
.section-padding h2::after {
    content: '';
    position: absolute;
    bottom: 0;
    right: 50%;
    transform: translateX(50%);
    width: 80px;
    height: 1px;
    background: linear-gradient(to right, transparent, #34495e, transparent);
}

/* فاصله کمتر برای اولین بخش */
.newest-products {
    padding-top: 30px !important;
}

/* فاصله کمتر برای بخش اطلاعیه‌ها */
.announcement-section {
    padding: 30px 0 20px 0;
}

@media (max-width: 768px) {
    .section-padding {
        padding: 30px 0 25px 0;
    }
    
    .section-padding h2 {
        font-size: 1.3rem;
        padding-top: 15px;
        padding-bottom: 12px;
        margin-bottom: 20px !important;
    }
    
    .newest-products {
        padding-top: 25px !important;
    }
    
    .announcement-section {
        padding: 25px 0 15px 0;
    }
}

@media (max-width: 480px) {
    .section-padding {
        padding: 25px 0 20px 0;
    }
    
    .section-padding h2 {
        font-size: 1.2rem;
        padding-top: 12px;
        padding-bottom: 10px;
        margin-bottom: 15px !important;
    }
    
    .section-padding h2::before,
    .section-padding h2::after {
        width: 60px;
    }
    
    .newest-products {
        padding-top: 20px !important;
    }
    
    .announcement-section {
        padding: 20px 0 10px 0;
    }
}
    </style>

    <!-- JavaScript برای اسلایدر نقطه‌ای -->
    <script>
        // تابع ایجاد اسلایدر نقطه‌ای با قابلیت کشیدن
        function initDotSlider(sliderId, dotsId, autoplayDelay = 5000) {
            const sliderWrapper = document.getElementById(sliderId);
            const dotsContainer = document.getElementById(dotsId);
            
            if (!sliderWrapper || !dotsContainer) return;
            
            const container = sliderWrapper.querySelector('.slider-container');
            const items = Array.from(container.querySelectorAll('.product-card-glass'));
            const totalItems = items.length;
            
            if (totalItems === 0) return;
            
            // تعیین تعداد آیتم در هر اسلاید بر اساس اندازه صفحه
            function getItemsPerSlide() {
                const width = window.innerWidth;
                if (width <= 480) return 1;
                if (width <= 576) return 2;
                if (width <= 768) return 3;
                if (width <= 992) return 4;
                if (width <= 1200) return 5;
                return 6;
            }
            
            let itemsPerSlide = getItemsPerSlide();
            let totalSlides = Math.ceil(totalItems / itemsPerSlide);
            let currentSlide = 0;
            let autoplayInterval;
            let isDragging = false;
            let startPos = 0;
            let currentTranslate = 0;
            let prevTranslate = 0;
            
            // ایجاد نقطه‌ها
            function createDots() {
                dotsContainer.innerHTML = '';
                for (let i = 0; i < totalSlides; i++) {
                    const dot = document.createElement('span');
                    dot.classList.add('dot');
                    if (i === 0) dot.classList.add('active');
                    dot.addEventListener('click', () => goToSlide(i));
                    dotsContainer.appendChild(dot);
                }
            }
            
            // تابع رفتن به اسلاید مشخص
            function goToSlide(index) {
                if (index < 0) index = 0;
                if (index >= totalSlides) index = totalSlides - 1;
                
                currentSlide = index;
                const offset = currentSlide * 100;
                container.style.transform = `translateX(${offset}%)`;
                
                const dots = dotsContainer.querySelectorAll('.dot');
                dots.forEach((dot, i) => {
                    dot.classList.toggle('active', i === currentSlide);
                });
                
                resetAutoplay();
            }
            
            // تابع اسلاید بعدی
            function nextSlide() {
                if (currentSlide < totalSlides - 1) {
                    goToSlide(currentSlide + 1);
                } else {
                    goToSlide(0);
                }
            }
            
            // شروع autoplay
            function startAutoplay() {
                autoplayInterval = setInterval(nextSlide, autoplayDelay);
            }
            
            // ریست autoplay
            function resetAutoplay() {
                clearInterval(autoplayInterval);
                startAutoplay();
            }
            
            // چیدمان آیتم‌ها
            function layoutItems() {
                itemsPerSlide = getItemsPerSlide();
                totalSlides = Math.ceil(totalItems / itemsPerSlide);
                
                items.forEach((item, index) => {
                    const slideIndex = Math.floor(index / itemsPerSlide);
                    const positionInSlide = index % itemsPerSlide;
                    item.style.position = 'absolute';
                    item.style.right = `${(slideIndex * 100) + (positionInSlide * (100 / itemsPerSlide))}%`;
                    item.style.transition = 'none';
                });
                
                createDots();
                goToSlide(0);
            }
            
            // رویدادهای کشیدن با موس
            function touchStart(e) {
                isDragging = true;
                startPos = e.type.includes('mouse') ? e.pageX : e.touches[0].clientX;
                container.style.transition = 'none';
            }
            
            function touchMove(e) {
                if (!isDragging) return;
                
                const currentPosition = e.type.includes('mouse') ? e.pageX : e.touches[0].clientX;
                const diff = currentPosition - startPos;
                const movePercent = (diff / container.offsetWidth) * 100;
                
                currentTranslate = (currentSlide * 100) + movePercent;
                container.style.transform = `translateX(${currentTranslate}%)`;
            }
            
            function touchEnd() {
                if (!isDragging) return;
                isDragging = false;
                
                const movedBy = currentTranslate - (currentSlide * 100);
                
                container.style.transition = 'transform 0.6s ease-in-out';
                
                if (movedBy < -15 && currentSlide < totalSlides - 1) {
                    goToSlide(currentSlide + 1);
                } else if (movedBy > 15 && currentSlide > 0) {
                    goToSlide(currentSlide - 1);
                } else {
                    goToSlide(currentSlide);
                }
            }
            
            // اضافه کردن event listeners
            container.addEventListener('mousedown', touchStart);
            container.addEventListener('touchstart', touchStart, { passive: true });
            
            container.addEventListener('mousemove', touchMove);
            container.addEventListener('touchmove', touchMove, { passive: true });
            
            container.addEventListener('mouseup', touchEnd);
            container.addEventListener('mouseleave', touchEnd);
            container.addEventListener('touchend', touchEnd);
            
            // جلوگیری از کلیک در حین drag
            container.addEventListener('click', (e) => {
                if (Math.abs(currentTranslate - (currentSlide * 100)) > 5) {
                    e.preventDefault();
                    e.stopPropagation();
                }
            }, true);
            
            // توقف autoplay هنگام hover
            sliderWrapper.addEventListener('mouseenter', () => clearInterval(autoplayInterval));
            sliderWrapper.addEventListener('mouseleave', startAutoplay);
            
            // مدیریت تغییر اندازه صفحه
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    layoutItems();
                }, 250);
            });
            
            // راه‌اندازی اولیه
            layoutItems();
            startAutoplay();
        }
        
        // راه‌اندازی همه اسلایدرها
        document.addEventListener('DOMContentLoaded', function() {
            initDotSlider('newestSlider', 'newestDots', 5000);
            initDotSlider('discountedSlider', 'discountedDots', 5000);
            initDotSlider('menSlider', 'menDots', 5000);
            initDotSlider('womenSlider', 'womenDots', 5000);
            initDotSlider('kidsSlider', 'kidsDots', 5000);
        });
    </script>

{% endblock content %}